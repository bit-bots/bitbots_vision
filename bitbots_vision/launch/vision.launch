<?xml version="1.0" encoding="utf-8" ?>
<launch>
    <!-- Get launch params-->
    <arg name="sim" default="false" description="true: activates simulation time and switches to simulation color settings" />
    <arg name="debug" default="false" description="true: activates publishing of several debug images" />
    <arg name="yoeo" default="true" description="true: uses yoeo detection, else yolo and conventional methods" />

    <let if="$(env IS_ROBOT false)" name="taskset" value="taskset -c 7"/>
    <let unless="$(env IS_ROBOT false)" name="taskset" value=""/>

    <group if="$(var yoeo)">
        <!-- Start the YOEO vision normally-->
        <group unless="$(var sim)">
            <node pkg="bitbots_vision" exec="yoeo_vision" name="bitbots_vision" output="screen" launch-prefix="$(var taskset)">
                <!-- Set vision config -->
                <param from="$(find-pkg-share bitbots_vision)/config/yoeo_visionparams.yaml" />

                <!-- Set debug params-->
                <param name="vision_publish_debug_image" value="$(var debug)" />
                <param name="vision_publish_field_mask_image" value="$(var debug)" />
            </node>
        </group>
        <!-- Start the YOEO vision in sim configuration-->
        <group if="$(var sim)">
            <node pkg="bitbots_vision" exec="yoeo_vision" name="bitbots_vision" output="screen" launch-prefix="$(var taskset)">
                <!-- Set vision config -->
                <param from="$(find-pkg-share bitbots_vision)/config/yoeo_visionparams.yaml" />
                <!-- Partially overwrite vision config with sim params-->
                <param from="$(find-pkg-share bitbots_vision)/config/simparams.yaml"/>

                <!-- Set debug params-->
                <param name="vision_publish_debug_image" value="$(var debug)" />
                <param name="vision_publish_field_mask_image" value="$(var debug)" />

                <!-- Use sim time-->
                <param name="use_sim_time" value="true"/>
            </node>
        </group>
    </group>

    <group unless="$(var yoeo)">
        <!-- Start the vision normally-->
        <group unless="$(var sim)">
            <node pkg="bitbots_vision" exec="vision" name="bitbots_vision" output="screen" launch-prefix="$(var taskset)">
                <!-- Set vision config -->
                <param from="$(find-pkg-share bitbots_vision)/config/visionparams.yaml" />

                <!-- Set debug params-->
                <param name="vision_publish_debug_image" value="$(var debug)" />
                <param name="vision_publish_HSV_mask_image" value="$(var debug)" />
                <param name="vision_publish_field_mask_image" value="$(var debug)" />
            </node>
        </group>
        <!-- Start the vision in sim configuration-->
        <group if="$(var sim)">
            <node pkg="bitbots_vision" exec="vision" name="bitbots_vision" output="screen" launch-prefix="$(var taskset)">
                <!-- Set vision config -->
                <param from="$(find-pkg-share bitbots_vision)/config/visionparams.yaml" />
                <!-- Partially overwrite vision config with sim params-->
                <param from="$(find-pkg-share bitbots_vision)/config/simparams.yaml"/>

                <!-- Set debug params-->
                <param name="vision_publish_debug_image" value="$(var debug)" />
                <param name="vision_publish_HSV_mask_image" value="$(var debug)" />
                <param name="vision_publish_field_mask_image" value="$(var debug)" />

                <!-- Use sim time-->
                <param name="use_sim_time" value="true"/>
            </node>
        </group>
    </group>
</launch>
